#+TITLE:An Org-mode buffer management tool

The function `org-buffers-list' creates a read-only Org-mode buffer
populated with links to currently open buffers. By default, buffers
are grouped by major mode. Buffers can be flagged for deletion (d) and
pending operations executed (x), in a similar way to dired and
buffer-menu-mode.

Type "?" to see all available actions, and also see the variables

- org-buffers-buffer-properties
- org-buffers-excluded-modes
- org-buffers-excluded-buffers
- org-buffers-mode-hook
- org-buffers-buffer-name

* Tasks [12/25]
*** TODO Don't get possible properties from buffer
*** TODO Return to lines state if start in line state
*** TODO Move to next after d/u
*** TODO Check whether we really need to refresh in some places?
    If current state same as new state then don't refresh?
*** TODO Check whether already in OK state [[file:org-buffers.el::org%20buffers%20list%20by%20NONE][here]]
*** TODO use reset state to set state initially
    Don't code defaults twice
*** TODO Only offer sensible grouping properties, with shortcut keys
*** DONE Keybindings for flat and column view
*** TODO Clean out unused code / undesired functionality
    - Get rid of insert-as-list-item?
    - Get rid of [[file:org-buffers.el::while%20not%20org%20buffers%20state%20eq%20atom%20heading][this]] while loop
*** STARTED Operations on buffers [3/3]
    These work by setting tags to define pending operations, and then
    executing those operations.
***** Show buffer-modified
***** Save buffer
***** Show buffer read-only
***** Link following behaviour
      The philosophy is that RET should do what org would do on a link; this
      concern overrides the fact that dired and Buffer-menu-mode use switch
      to buffer in current window on RET. Instead we use, currently, '.' for
      current window. Like dired and Buffer-menu-mode we use 'o' for other
      window (which may well have the same effect as RET).

***** Implement other actions of dired or buffer-menu-mode?
***** DONE o
***** DONE u
***** DONE kill buffer
*** STARTED Filtering, folding and sorting
***** TODO Add modes which should be folded by default
***** DONE Buffer-name blacklist for filtering
***** DONE Major mode blacklist for filtering
***** Sort by recency?
***** When grouping by file/dir, use directory hierarchy?
***** When grouped by dirs, make dirnames links to dired?
***** Store further buffer properties
      - buffer-modified-p
      - buffer size
      - buffer minor modes
*** TODO Sort upper case with lower case?
*** DONE Sorting withing groups?
*** TODO Speed up
    The critical functions are
    - org-buffers-insert-entry
    - org-buffers-group-by

    - [X] Profiling ::
	  How did Matt Lundin do timings?
*** PROPOSED use inhibit-read-only-p
*** PROPOSED Display multiple visible buffers
*** TODO order of calls
   around (org-overview) in o-b-list
*** Message when following link to visible buffer
    and hence doing nothing
*** Extend to files?
    - recent files?
*** Organise by frames
*** Is (s-e (b-o-l) (outline-level)) idiomatic?
*** DONE Deal with acting on region more correctly
    I.e. Is it right that d is for this line whereas D is for region?
*** DONE Implement clean view using regexp substitution
*** DONE Use stripped down mapping function
*** DONE Renaming
***** DONE s/(org-buffers-)list/$1/
***** DONE params -> state
*** DONE Set meaningful tags as buffer-local variable
    To be offered as tag completions
*** DONE Add hook
    E.g. to
    - replace the terminal -mode on major mode names
    - filter buffers / major modes
*** DONE Make RET work elsewhere on header line to follow link?
    Could do this with a speed command.
*** DONE Macro for working with params?
* Bugs [29/35]
*** DONE Fix toggling headings in flat mode bug
*** PROPOSED deleting last buffer in flat mode caused error
    if: Args out of range: 864, 1118
    can't recreate this?
*** TODO Need to disable things when entering colview and reenable when exiting
*** TODO d in columns-view deletes everything but current
*** TODO when deleting many keep in sensible state even if back out half way
    e.g. you might back out when alerted that modified and asked if
    you want to save.
*** TODO Why are all org files being opened sometimes?

    I.e. as if agenda had been called
    'Getting targets...'
*** TODO Keybindings conflicts
***** We are over-riding speed commands
***** E.g. p conflicts with p in / dispatcher.
***** Conflicts with column-view keys
*** TODO Point movement with g in lines mode
    because heading search target is above point
    Solving this would require searching for line rather than heading.
*** DONE delete last entry in buffer when region active
*** DONE Don't jump to non-existent buffer
*** DONE all properties exposed after using :by
    C-x k *Buffers*
    C-x C-b
    ,
    b
    de RET

    dirname -> major-mode
*** DONE Set tag if region encompasses part of one line only
    Currently does in lines mode but not in headings mode
*** DONE stop region taking too much
*** DONE stop deleting whole subtrees
*** DONE I got NONE as only property once
    This is when use b without properties present in buffer. I believe
    getting into this state is a bug caused by error (usually a
    before-first-heading error) and so should be fixed.
*** DONE Grouping by property that can be nil screws up
*** DONE point movement when inserting properties
    when grouped by major mode, put point on first level 1 heading ,
    p, point moves down to level 2.
*** DONE Column view needs to get rid of buffer-read-only
*** DONE Don't show all on flat view
*** DONE before first heading when list:flat
*** DONE Should get rid of properties when moving to lines mode?
*** No such buffer nil on RET to deleted
    This error message from org-open-at-point
*** Compare details of region selection with other modes
*** How to check for current minor modes?
    Ratheer than testing buffer name
*** DONE overzealous -mode chomping hook function
*** DONE Point movement when properties
*** DONE D in line mode sets on first of region only
*** DONE d on single line causes previous one to get tag also
*** DONE %20 in buffer name
*** DONE Deleting last 4 caused text screw up
*** DONE Tags can be hard to line up with buffers
*** DONE Tags for deletion [3/3]
***** DONE Deletes alternates
***** DONE Needs active region
***** DONE Executing pending doesn't work first time
*** DONE Stop hijacking keys in other org buffers
*** DONE Make tags visible
*** CANCELLED Stop buffer links over-riding file links
    and yet make them usable.
    I've set them not to store on org-store-link
*** CANCELLED Add context to buffer links
    Can use [[file:/usr/local/src/emacs/org-mode-core/lisp/org.el::org%20make%20org%20heading%20search%20string%20txt][this]] for org buffers. I'm leaving this for now.
*** CANCELLED Don't use props for b-m-p? just tags
*** CANCELLED Get rid of newline at eob 
* Profiling
*** code
#+begin_src emacs-lisp :results silent
  (org-buffers-list)
  (elp-reset-all)
  (elp-instrument-package "org-buffers")
  (dotimes (i 10)
    (message (format "%d" i))
    (org-buffers-list:by "major-mode"))
  (elp-results)
#+end_src

*** before map headings macro
org-buffers-list:by                        10          40.482967     4.0482967
org-buffers-list                           11          40.480842     3.6800765454
org-buffers-group-by                       11          19.152886     1.7411714545
org-buffers-map-entries                    242         17.471287999  0.0721954049
org-buffers-parse-selected-entries         231         16.984615000  0.0735264718
org-buffers-toggle-properties              1           3.538426      3.538426
org-buffers-insert-parsed-entry            891         1.2092340000  0.0013571649
org-buffers-get-buffer-props               891         0.1646129999  0.0001847508
org-buffers-exclude-p                      1144        0.0496820000  4.342...e-05
org-buffers-mode                           11          0.001076      9.781...e-05
org-buffers-set-state                      22          0.0006159999  2.799...e-05


*** 3
***** Timings
      Ignore top time as this includes user dithering.
******* by: dirname -> major-mode
********* init
org-buffers-list:by                        1           5.914523      5.914523
org-buffers-list                           1           3.922159      3.922159
org-buffers-map-entries                    23          1.8343449999  0.0797541304
org-buffers-group-by                       1           1.73983       1.73983
org-buffers-parse-selected-entries         21          1.5756780000  0.0750322857
org-buffers-insert-entry                   81          1.5235690000  0.0188094938
org-buffers-insert-parsed-entry            81          0.0770639999  0.0009514074
org-buffers-parse-entry                    81          0.020705      0.0002556172
org-buffers-get-buffer-props               81          0.0150890000  0.0001862839
org-buffers-exclude-p                      104         0.0052450000  5.043...e-05
org-buffers-mode                           1           0.000135      0.000135
org-buffers-set-state                      2           7.099...e-05  3.549...e-05

********* with parse-buffer inline
org-buffers-list:by                        1           5.638731      5.638731
org-buffers-list                           1           3.542067      3.542067
org-buffers-map-entries                    23          2.0996669999  0.0912898695
org-buffers-group-by                       1           1.99616       1.99616
org-buffers-parse-selected-entries         21          1.2383170000  0.0589674761
org-buffers-insert-entry                   81          1.1949499999  0.0147524691
org-buffers-insert-parsed-entry            81          0.371138      0.0045819506
org-buffers-get-buffer-props               81          0.0142690000  0.0001761604
org-buffers-exclude-p                      104         0.005389      5.181...e-05
org-buffers-mode                           1           8.8e-05       8.8e-05
org-buffers-set-state                      2           7.2e-05       3.6e-05

********* with dolist in o-b-list
org-buffers-list:by                        1           5.802007      5.802007
org-buffers-list                           1           3.53931       3.53931
org-buffers-map-entries                    23          1.79665       0.0781152173
org-buffers-group-by                       1           1.715616      1.715616
org-buffers-insert-entry                   81          1.468053      0.0181241111
org-buffers-parse-selected-entries         21          1.253252      0.0596786666
org-buffers-insert-parsed-entry            81          0.3776680000  0.0046625679
org-buffers-get-buffer-props               81          0.0150909999  0.0001863086
org-buffers-exclude-p                      104         0.0043040000  4.138...e-05
org-buffers-mode                           1           8.8e-05       8.8e-05
org-buffers-set-state                      2           7.3e-05       3.65e-05
********* with insert-entry inline
*********** 2
org-buffers-list:by                        1           4.991089      4.991089
org-buffers-list                           1           3.435613      3.435613
org-buffers-map-entries                    23          2.0616669999  0.0896376956
org-buffers-group-by                       1           1.669686      1.669686
org-buffers-parse-selected-entries         21          1.508732      0.0718443809
org-buffers-insert-parsed-entry            81          0.0756260000  0.0009336543
org-buffers-get-buffer-props               81          0.0142789999  0.0001762839
org-buffers-exclude-p                      104         0.004253      4.089...e-05
org-buffers-mode                           1           0.000106      0.000106
org-buffers-set-state                      2           7.3e-05       3.65e-05
*********** 1
org-buffers-list:by                        1           5.802236      5.802236
org-buffers-list                           1           3.576863      3.576863
org-buffers-map-entries                    23          1.8523519999  0.0805370434
org-buffers-group-by                       1           1.739365      1.739365
org-buffers-parse-selected-entries         21          1.5744040000  0.0749716190
org-buffers-insert-parsed-entry            81          0.0765689999  0.0009452962
org-buffers-get-buffer-props               81          0.0151230000  0.0001867037
org-buffers-exclude-p                      104         0.0046640000  4.484...e-05
org-buffers-mode                           1           8.4e-05       8.4e-05
org-buffers-s


******* major-mode -> dirname
org-buffers-list:by                        1           9.14238       9.14238
org-buffers-list                           1           3.553673      3.553673
org-buffers-map-entries                    24          1.8469299999  0.0769554166
org-buffers-group-by                       1           1.742176      1.742176
org-buffers-insert-entry                   81          1.4543199999  0.0179545679
org-buffers-parse-selected-entries         22          1.284015      0.0583643181
org-buffers-insert-parsed-entry            81          0.0775440000  0.0009573333
org-buffers-parse-entry                    81          0.0196320000  0.0002423703
org-buffers-get-buffer-props               81          0.0145090000  0.0001791234
org-buffers-exclude-p                      104         0.0043900000  4.221...e-05
org-buffers-mode                           1           0.000135      0.000135
org-buffers-set-state                      2           7.3e-05       3.65e-05
*** 1
***** Buffers
******* fundamental
********* [[buffer:*ELP%20Profiling%20Results*][*ELP Profiling Results*]]
********* [[buffer:*ESS*][*ESS*]]
********* [[buffer:*Messages*][*Messages*]]
******* help
********* [[buffer:*Help*][*Help*]]
******* lisp-interaction
********* [[buffer:*scratch*][*scratch*]]
******* org
********* [[buffer:R.org][R.org]]
********* [[buffer:abc.org][abc.org]]
********* [[buffer:books.org][books.org]]
********* [[buffer:brithist.org][brithist.org]]
********* [[buffer:bs-pca.org][bs-pca.org]]
********* [[buffer:camera.org][camera.org]]
********* [[buffer:cmdline.org][cmdline.org]]
********* [[buffer:computing.org][computing.org]]
********* [[buffer:dbm.org][dbm.org]]
********* [[buffer:eee.org][eee.org]]
********* [[buffer:emacs.org][emacs.org]]
********* [[buffer:events.org][events.org]]
********* [[buffer:films.org][films.org]]
********* [[buffer:food.org][food.org]]
********* [[buffer:geospiza.org][geospiza.org]]
********* [[buffer:git.org][git.org]]
********* [[buffer:info.org][info.org]]
********* [[buffer:jobs.org][jobs.org]]
********* [[buffer:js-mr.org][js-mr.org]]
********* [[buffer:linux-setup.org][linux-setup.org]]
********* [[buffer:mary.org][mary.org]]
********* [[buffer:music.org][music.org]]
********* [[buffer:musiclib.org][musiclib.org]]
********* [[buffer:notes.org][notes.org]]
********* [[buffer:org-R.org][org-R.org]]
********* [[buffer:org.org][org.org]]
********* [[buffer:pa-bgs.org][pa-bgs.org]]
********* [[buffer:panama.org][panama.org]]
********* [[buffer:pdflib.org][pdflib.org]]
********* [[buffer:people.org][people.org]]
********* [[buffer:pobi.org][pobi.org]]
********* [[buffer:presents.org][presents.org]]
********* [[buffer:reading.org][reading.org]]
********* [[buffer:rockbox.org][rockbox.org]]
********* [[buffer:sept09-trip.org][sept09-trip.org]]
********* [[buffer:sergio.org][sergio.org]]
********* [[buffer:shellfish.org][shellfish.org]]
********* [[buffer:tasks.org][tasks.org]]
********* [[buffer:thoughts.org][thoughts.org]]
********* [[buffer:ubuntu.org][ubuntu.org]]
********* [[buffer:visa.org][visa.org]]
********* [[buffer:want.org][want.org]]
********* [[buffer:work-etc.org][work-etc.org]]
********* [[buffer:work.org][work.org]]
********* [[buffer:wuetal-results.org][wuetal-results.org]]
********* [[buffer:wuetal-structure.org][wuetal-structure.org]]
********* [[buffer:wuetal.org][wuetal.org]]
******* org-agenda
********* [[buffer:*Org%20Agenda*][*Org Agenda*]]
***** Times
Times for "g"

org-buffers-list:refresh                   1           1.349756      1.349756
org-buffers-list                           1           1.349729      1.349729
org-buffers-insert-entry                   53          0.7780579999  0.0146803396
org-buffers-group-by                       1           0.363466      0.363466
org-buffers-map-entries                    6           0.3291670000  0.0548611666
org-buffers-parse-selected-entries         5           0.304079      0.0608157999
org-buffers-insert-parsed-entry            53          0.0234120000  0.0004417358
org-buffers-parse-entry                    53          0.010689      0.0002016792
org-buffers-get-buffer-props               53          0.0098219999  0.0001853207
org-buffers-exclude-p                      62          0.0028829999  4.65e-05
org-buffers-mode                           1           9.4e-05       9.4e-05
org-buffers-set-state                      1           2.5e-05       2.5e-05
*** 2
***** Buffers
******* dired
********* [[buffer:lisp][lisp]]
********* [[buffer:src][src]]
******* emacs-lisp
********* [[buffer:org-buffers.el][org-buffers.el]]
******* fundamental
********* [[buffer:*ESS*][*ESS*]]
********* [[buffer:*Messages*][*Messages*]]
********* [[buffer:*magit-process*][*magit-process*]]
********* [[buffer:*magit-tmp*][*magit-tmp*]]
********* [[buffer:*mairix%20output*][*mairix output*]]
********* [[buffer:.newsrc-dribble][.newsrc-dribble]]
******* gnus-article
********* [[buffer:*Article%20nnimap%2Bdc:.zz_mairix-gen-mairix-1*][*Article nnimap+dc:.zz_mairix-gen-mairix-1*]]
********* [[buffer:*Article*][*Article*]]
******* gnus-browse
********* [[buffer:*Gnus%20Browse%20Server*][*Gnus Browse Server*]]
******* gnus-group
********* [[buffer:*Group*][*Group*]]
******* gnus-server
********* [[buffer:*Server*][*Server*]]
******* gnus-summary
********* [[buffer:*Summary%20INBOX*][*Summary INBOX*]]
********* [[buffer:*Summary%20nnimap%2Bdc:.zz_mairix-gen-mairix-1*][*Summary nnimap+dc:.zz_mairix-gen-mairix-1*]]
******* help
********* [[buffer:*Help*][*Help*]]
******* magit
********* [[buffer:*magit:%20org-buffers*][*magit: org-buffers*]]
********* [[buffer:*magit:%20src*][*magit: src*]]
******* magit-log-edit
********* [[buffer:*magit-log-edit*][*magit-log-edit*]]
******* mail
********* [[buffer:*mail*][*mail*]]
******* message
********* [[buffer:*sent%20mail%20to%20Tina%20Hu*][*sent mail to Tina Hu*]]
********* [[buffer:*sent%20mail%20to%20dandavison0@gmail.com*][*sent mail to dandavison0@gmail.com*]]
********* [[buffer:*sent%20mail%20to%20ithelp@stats.ox.ac.uk*][*sent mail to ithelp@stats.ox.ac.uk*]]
********* [[buffer:*sent%20wide%20reply%20to%20Dan%20Davison*][*sent wide reply to Dan Davison*]]
********* [[buffer:*sent%20wide%20reply%20to%20Dan%20Davison*<2>][*sent wide reply to Dan Davison*<2>]]
********* [[buffer:*sent%20wide%20reply%20to%20Martin%20Davison*][*sent wide reply to Martin Davison*]]
********* [[buffer:*sent%20wide%20reply%20to%20Scott%20Kostyshak*][*sent wide reply to Scott Kostyshak*]]
******* org
********* [[buffer:R.org][R.org]]
********* [[buffer:README][README]]
********* [[buffer:abc.org][abc.org]]
********* [[buffer:books.org][books.org]]
********* [[buffer:brithist.org][brithist.org]]
********* [[buffer:bs-pca.org][bs-pca.org]]
********* [[buffer:camera.org][camera.org]]
********* [[buffer:cmdline.org][cmdline.org]]
********* [[buffer:computing.org][computing.org]]
********* [[buffer:dbm.org][dbm.org]]
********* [[buffer:dmesg][dmesg]]
********* [[buffer:eee.org][eee.org]]
********* [[buffer:emacs.org][emacs.org]]
********* [[buffer:events.org][events.org]]
********* [[buffer:films.org][films.org]]
********* [[buffer:food.org][food.org]]
********* [[buffer:geospiza.org][geospiza.org]]
********* [[buffer:getmailrc-stats][getmailrc-stats]]
********* [[buffer:git.org][git.org]]
********* [[buffer:info.org][info.org]]
********* [[buffer:jobs.org][jobs.org]]
********* [[buffer:js-mr.org][js-mr.org]]
********* [[buffer:linux-setup.org][linux-setup.org]]
********* [[buffer:mary.org][mary.org]]
********* [[buffer:music.org][music.org]]
********* [[buffer:musiclib.org][musiclib.org]]
********* [[buffer:simsec.org][simsec.org]]
********* [[buffer:tmp][tmp]]
********* [[buffer:update][update]]
********* [[buffer:update<2>][update<2>]]
********* [[buffer:z.org][z.org]]
******* perl
********* [[buffer:msg.pl][msg.pl]]
******* sh
********* [[buffer:getmail-dan][getmail-dan]]
********* [[buffer:sendmail-dan][sendmail-dan]]
***** Times
******* 1
org-buffers-list:refresh                   1           2.03182       2.03182
org-buffers-list                           1           2.031728      2.031728
org-buffers-group-by                       1           1.08542       1.08542
org-buffers-insert-entry                   62          0.895063      0.0144365000
org-buffers-map-entries                    17          0.782671      0.0460394705
org-buffers-parse-selected-entries         16          0.753268      0.04707925
org-buffers-insert-parsed-entry            62          0.0254550000  0.0004105645
org-buffers-parse-entry                    62          0.013704      0.0002210322
org-buffers-get-buffer-props               62          0.0108809999  0.0001754999
org-buffers-exclude-p                      83          0.0059429999  7.160...e-05
org-buffers-mode                           1           8.7e-05       8.7e-05
org-buffers-set-state                      1           2.4e-05       2.4e-05
******* 2
org-buffers-list:refresh                   1           2.577224      2.577224
org-buffers-list                           1           2.577192      2.577192
org-buffers-group-by                       1           1.264802      1.264802
org-buffers-insert-entry                   69          0.9877069999  0.0143145942
org-buffers-map-entries                    19          0.9401300000  0.0494805263
org-buffers-parse-selected-entries         18          0.907364      0.0504091111
org-buffers-insert-parsed-entry            69          0.0284710000  0.0004126231
org-buffers-parse-entry                    69          0.0154210000  0.0002234927
org-buffers-get-buffer-props               69          0.0132330000  0.0001917826
org-buffers-exclude-p                      90          0.0035400000  3.933...e-05
org-buffers-mode                           1           8.9e-05       8.9e-05
org-buffers-set-state                      1           2.4e-05       2.4e-05

******* dolist
org-buffers-list:refresh                   1           2.3848380000  2.3848380000
org-buffers-list                           1           2.384798      2.384798
org-buffers-insert-entry                   69          1.3048409999  0.0189107391
org-buffers-group-by                       1           1.02626       1.02626
org-buffers-map-entries                    19          0.964197      0.0507472105
org-buffers-parse-selected-entries         18          0.9301770000  0.0516765000
org-buffers-insert-parsed-entry            69          0.0307469999  0.0004456086
org-buffers-parse-entry                    69          0.0161510000  0.0002340724
org-buffers-get-buffer-props               69          0.0122460000  0.0001774782
org-buffers-exclude-p                      90          0.005709      6.343...e-05
org-buffers-mode                           1           8.7e-05       8.7e-05
org-buffers-set-state                      1           2.4e-05       2.4e-05
* Org config							   :noexport:
#+TODO: TODO STARTED | PROPOSED DONE CANCELLED
